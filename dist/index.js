"use strict";var ur=Object.create;var Ye=Object.defineProperty;var dr=Object.getOwnPropertyDescriptor;var pr=Object.getOwnPropertyNames,St=Object.getOwnPropertySymbols,yr=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty,mr=Object.prototype.propertyIsEnumerable;var jt=e=>{throw TypeError(e)};var Xe=(e,t,r)=>t in e?Ye(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Le=(e,t)=>{for(var r in t||(t={}))Pt.call(t,r)&&Xe(e,r,t[r]);if(St)for(var r of St(t))mr.call(t,r)&&Xe(e,r,t[r]);return e};var br=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of pr(t))!Pt.call(e,n)&&n!==r&&Ye(e,n,{get:()=>t[n],enumerable:!(s=dr(t,n))||s.enumerable});return e};var vr=(e,t,r)=>(r=e!=null?ur(yr(e)):{},br(t||!e||!e.__esModule?Ye(r,"default",{value:e,enumerable:!0}):r,e));var d=(e,t,r)=>Xe(e,typeof t!="symbol"?t+"":t,r),Je=(e,t,r)=>t.has(e)||jt("Cannot "+r);var o=(e,t,r)=>(Je(e,t,"read from private field"),r?r.call(e):t.get(e)),p=(e,t,r)=>t.has(e)?jt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),u=(e,t,r,s)=>(Je(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),y=(e,t,r)=>(Je(e,t,"access private method"),r);var At=(e,t,r,s)=>({set _(n){u(e,t,n,r)},get _(){return o(e,t,s)}});var x=(e,t,r)=>new Promise((s,n)=>{var a=i=>{try{h(r.next(i))}catch(l){n(l)}},c=i=>{try{h(r.throw(i))}catch(l){n(l)}},h=i=>i.done?s(i.value):Promise.resolve(i.value).then(a,c);h((r=r.apply(e,t)).next())});var Ht=require("http"),tt=require("http2"),Ct=require("stream"),Lt=vr(require("crypto"),1);var et,De=(et=class extends Error{constructor(e,t){super(e,t)}},d(et,"name","RequestError"),et),Rr=e=>e instanceof De?e:new De(e.message,{cause:e}),gr=global.Request,be=class extends gr{constructor(e,t){var r,s;typeof e=="object"&&ie in e&&(e=e[ie]()),typeof((r=t==null?void 0:t.body)==null?void 0:r.getReader)!="undefined"&&((s=t.duplex)!=null||(t.duplex="half")),super(e,t)}},wr=(e,t,r,s)=>{let n=[],a=r.rawHeaders;for(let h=0;h<a.length;h+=2){let{[h]:i,[h+1]:l}=a;i.charCodeAt(0)!==58&&n.push([i,l])}let c={method:e,headers:n,signal:s.signal};if(e==="TRACE"){c.method="GET";let h=new be(t,c);return Object.defineProperty(h,"method",{get(){return"TRACE"}}),h}return e==="GET"||e==="HEAD"||(c.body=Ct.Readable.toWeb(r)),new be(t,c)},ie=Symbol("getRequestCache"),Ze=Symbol("requestCache"),rt=Symbol("incomingKey"),st=Symbol("urlKey"),me=Symbol("abortControllerKey"),nt=Symbol("getAbortController"),$e={get method(){return this[rt].method||"GET"},get url(){return this[st]},[nt](){return this[ie](),this[me]},[ie](){return this[me]||(this[me]=new AbortController),this[Ze]||(this[Ze]=wr(this.method,this[st],this[rt],this[me]))}};["body","bodyUsed","cache","credentials","destination","headers","integrity","mode","redirect","referrer","referrerPolicy","signal","keepalive"].forEach(e=>{Object.defineProperty($e,e,{get(){return this[ie]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty($e,e,{value:function(){return this[ie]()[e]()}})});Object.setPrototypeOf($e,be.prototype);var Er=(e,t)=>{let r=Object.create($e);r[rt]=e;let s=(e instanceof tt.Http2ServerRequest?e.authority:e.headers.host)||t;if(!s)throw new De("Missing host header");let n=new URL(`${e instanceof tt.Http2ServerRequest||e.socket&&e.socket.encrypted?"https":"http"}://${s}${e.url}`);if(n.hostname.length!==s.length&&n.hostname!==s.replace(/:\d+$/,""))throw new De("Invalid host header");return r[st]=n.href,r};function ot(e,t){if(e.locked)throw new TypeError("ReadableStream is locked.");if(t.destroyed){e.cancel();return}let r=e.getReader();return t.on("close",s),t.on("error",s),r.read().then(a,s),r.closed.finally(()=>{t.off("close",s),t.off("error",s)});function s(c){r.cancel(c).catch(()=>{}),c&&t.destroy(c)}function n(){r.read().then(a,s)}function a({done:c,value:h}){try{if(c)t.end();else if(!t.write(h))t.once("drain",n);else return r.read().then(a,s)}catch(i){s(i)}}}var Tt=e=>{var s;let t={};e instanceof Headers||(e=new Headers(e!=null?e:void 0));let r=[];for(let[n,a]of e)n==="set-cookie"?r.push(a):t[n]=a;return r.length>0&&(t["set-cookie"]=r),(s=t["content-type"])!=null||(t["content-type"]="text/plain; charset=UTF-8"),t},_e=Symbol("responseCache"),ve=Symbol("getResponseCache"),Re=Symbol("cache"),Ie=global.Response,ge,G,oe,ae=(oe=class{constructor(t,r){p(this,ge);p(this,G);if(u(this,ge,t),r instanceof oe){let s=r[_e];if(s){u(this,G,s),this[ve]();return}else u(this,G,o(r,G))}else u(this,G,r);if(typeof t=="string"||typeof(t==null?void 0:t.getReader)!="undefined"){let s=(r==null?void 0:r.headers)||{"content-type":"text/plain; charset=UTF-8"};s instanceof Headers&&(s=Tt(s)),this[Re]=[(r==null?void 0:r.status)||200,t,s]}}[ve](){return delete this[Re],this[_e]||(this[_e]=new Ie(o(this,ge),o(this,G)))}},ge=new WeakMap,G=new WeakMap,oe);["body","bodyUsed","headers","ok","redirected","status","statusText","trailers","type","url"].forEach(e=>{Object.defineProperty(ae.prototype,e,{get(){return this[ve]()[e]}})});["arrayBuffer","blob","clone","formData","json","text"].forEach(e=>{Object.defineProperty(ae.prototype,e,{value:function(){return this[ve]()[e]()}})});Object.setPrototypeOf(ae,Ie);Object.setPrototypeOf(ae.prototype,Ie.prototype);var it=Reflect.ownKeys(new Ie).find(e=>typeof e=="symbol"&&e.toString()==="Symbol(state)");it||console.warn("Failed to find Response internal state key");function xr(e){if(!it)return;e instanceof ae&&(e=e[ve]());let t=e[it];return t&&t.body||void 0}var Or="x-hono-already-sent",Sr=global.fetch;typeof global.crypto=="undefined"&&(global.crypto=Lt.default);global.fetch=(e,t)=>(t=Le({compress:!1},t),Sr(e,t));var Pr=/^no$/i,jr=/^(application\/json\b|text\/(?!event-stream\b))/i,Ar=()=>new Response(null,{status:400}),_t=e=>new Response(null,{status:e instanceof Error&&(e.name==="TimeoutError"||e.constructor.name==="TimeoutError")?504:500}),at=(e,t)=>{let r=e instanceof Error?e:new Error("unknown error",{cause:e});r.code==="ERR_STREAM_PREMATURE_CLOSE"?console.info("The user aborted a request."):(console.error(e),t.headersSent||t.writeHead(500,{"Content-Type":"text/plain"}),t.end(`Error: ${r.message}`),t.destroy(r))},Dt=(e,t)=>{var a;let[r,s,n]=e[Re];if(typeof s=="string")n["Content-Length"]=Buffer.byteLength(s),t.writeHead(r,n),t.end(s);else return t.writeHead(r,n),(a=ot(s,t))==null?void 0:a.catch(c=>at(c,t))},Hr=(s,n,...a)=>x(void 0,[s,n,...a],function*(e,t,r={}){if(e instanceof Promise)if(r.errorHandler)try{e=yield e}catch(i){let l=yield r.errorHandler(i);if(!l)return;e=l}else e=yield e.catch(_t);if(Re in e)return Dt(e,t);let c=Tt(e.headers),h=xr(e);if(h){let{length:i,source:l,stream:f}=h;if(!(l instanceof Uint8Array&&l.byteLength!==i)){i&&(c["content-length"]=i),t.writeHead(e.status,c),typeof l=="string"||l instanceof Uint8Array?t.end(l):l instanceof Blob?t.end(new Uint8Array(yield l.arrayBuffer())):yield ot(f,t);return}}if(e.body){let{"transfer-encoding":i,"content-encoding":l,"content-length":f,"x-accel-buffering":m,"content-type":v}=c;if(i||l||f||m&&Pr.test(m)||!jr.test(v))t.writeHead(e.status,c),yield ot(e.body,t);else{let b=yield e.arrayBuffer();c["content-length"]=b.byteLength,t.writeHead(e.status,c),t.end(new Uint8Array(b))}}else c[Or]||(t.writeHead(e.status,c),t.end())}),Cr=(e,t={})=>(t.overrideGlobalObjects!==!1&&global.Request!==be&&(Object.defineProperty(global,"Request",{value:be}),Object.defineProperty(global,"Response",{value:ae})),(r,s)=>x(void 0,null,function*(){let n,a;try{if(a=Er(r,t.hostname),s.on("close",()=>{r.errored?a[nt]().abort(r.errored.toString()):s.writableFinished||a[nt]().abort("Client connection prematurely closed.")}),n=e(a,{incoming:r,outgoing:s}),Re in n)return Dt(n,s)}catch(c){if(n)return at(c,s);if(t.errorHandler){if(n=yield t.errorHandler(a?c:Rr(c)),!n)return}else a?n=_t(c):n=Ar()}try{return Hr(n,s,t)}catch(c){return at(c,s)}})),Tr=e=>{let t=e.fetch,r=Cr(t,{hostname:e.hostname,overrideGlobalObjects:e.overrideGlobalObjects});return(e.createServer||Ht.createServer)(e.serverOptions||{},r)},$t=(e,t)=>{var s;let r=Tr(e);return r.listen((s=e==null?void 0:e.port)!=null?s:3e3,e.hostname,()=>{let n=r.address();t&&t(n)}),r};var It=(r,...s)=>x(void 0,[r,...s],function*(e,t=Object.create(null)){let{all:n=!1,dot:a=!1}=t,h=(e instanceof Me?e.raw.headers:e.headers).get("Content-Type");return h!=null&&h.startsWith("multipart/form-data")||h!=null&&h.startsWith("application/x-www-form-urlencoded")?Lr(e,{all:n,dot:a}):{}});function Lr(e,t){return x(this,null,function*(){let r=yield e.formData();return r?_r(r,t):{}})}function _r(e,t){let r=Object.create(null);return e.forEach((s,n)=>{t.all||n.endsWith("[]")?Dr(r,n,s):r[n]=s}),t.dot&&Object.entries(r).forEach(([s,n])=>{s.includes(".")&&($r(r,s,n),delete r[s])}),r}var Dr=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},$r=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((a,c)=>{c===n.length-1?s[a]=r:((!s[a]||typeof s[a]!="object"||Array.isArray(s[a])||s[a]instanceof File)&&(s[a]=Object.create(null)),s=s[a])})};var ht=e=>{let t=e.split("/");return t[0]===""&&t.shift(),t},Mt=e=>{let{groups:t,path:r}=Ir(e),s=ht(r);return Mr(s,t)},Ir=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(r,s)=>{let n=`@${s}`;return t.push([n,r]),n}),{groups:t,path:e}},Mr=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},ke={},lt=e=>{if(e==="*")return"*";let t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(ke[e]||(t[2]?ke[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:ke[e]=[e,t[1],!0]),ke[e]):null},ft=(e,t)=>{try{return t(e)}catch(r){return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,s=>{try{return t(s)}catch(n){return s}})}},kr=e=>ft(e,decodeURI),ut=e=>{let t=e.url,r=t.indexOf("/",8),s=r;for(;s<t.length;s++){let n=t.charCodeAt(s);if(n===37){let a=t.indexOf("?",s),c=t.slice(r,a===-1?void 0:a);return kr(c.includes("%25")?c.replace(/%25/g,"%2525"):c)}else if(n===63)break}return t.slice(r,s)};var kt=e=>{let t=ut(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},ce=(...e)=>{let t="",r=!1;for(let s of e)t.at(-1)==="/"&&(t=t.slice(0,-1),r=!0),s[0]!=="/"&&(s=`/${s}`),s==="/"&&r?t=`${t}/`:s!=="/"&&(t=`${t}${s}`),s==="/"&&t===""&&(t="/");return t},qe=e=>{if(!e.match(/\:.+\?$/))return null;let t=e.split("/"),r=[],s="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))s+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){r.length===0&&s===""?r.push("/"):r.push(s);let a=n.replace("?","");s+="/"+a,r.push(s)}else s+="/"+n}),r.filter((n,a,c)=>c.indexOf(n)===a)},ct=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?dt(e):e):e,qt=(e,t,r)=>{var c;let s;if(!r&&t&&!/[%+]/.test(t)){let h=e.indexOf(`?${t}`,8);for(h===-1&&(h=e.indexOf(`&${t}`,8));h!==-1;){let i=e.charCodeAt(h+t.length+1);if(i===61){let l=h+t.length+2,f=e.indexOf("&",l);return ct(e.slice(l,f===-1?void 0:f))}else if(i==38||isNaN(i))return"";h=e.indexOf(`&${t}`,h+1)}if(s=/[%+]/.test(e),!s)return}let n={};s!=null||(s=/[%+]/.test(e));let a=e.indexOf("?",8);for(;a!==-1;){let h=e.indexOf("&",a+1),i=e.indexOf("=",a);i>h&&h!==-1&&(i=-1);let l=e.slice(a+1,i===-1?h===-1?void 0:h:i);if(s&&(l=ct(l)),a=h,l==="")continue;let f;i===-1?f="":(f=e.slice(i+1,h===-1?void 0:h),s&&(f=ct(f))),r?(n[l]&&Array.isArray(n[l])||(n[l]=[]),n[l].push(f)):(c=n[l])!=null||(n[l]=f)}return t?n[t]:n},Nt=qt,Bt=(e,t)=>qt(e,t,!0),dt=decodeURIComponent;var Ft=e=>ft(e,dt),he,T,M,Gt,Kt,pt,K,Ut,Me=(Ut=class{constructor(e,t="/",r=[[]]){p(this,M);d(this,"raw");p(this,he);p(this,T);d(this,"routeIndex",0);d(this,"path");d(this,"bodyCache",{});p(this,K,e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(a=>(n==="json"&&(a=JSON.stringify(a)),new Response(a)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,u(this,T,r),u(this,he,{})}param(e){return e?y(this,M,Gt).call(this,e):y(this,M,Kt).call(this)}query(e){return Nt(this.url,e)}queries(e){return Bt(this.url,e)}header(e){var r;if(e)return(r=this.raw.headers.get(e.toLowerCase()))!=null?r:void 0;let t={};return this.raw.headers.forEach((s,n)=>{t[n]=s}),t}parseBody(e){return x(this,null,function*(){var t,r;return(r=(t=this.bodyCache).parsedBody)!=null?r:t.parsedBody=yield It(this,e)})}json(){return o(this,K).call(this,"json")}text(){return o(this,K).call(this,"text")}arrayBuffer(){return o(this,K).call(this,"arrayBuffer")}blob(){return o(this,K).call(this,"blob")}formData(){return o(this,K).call(this,"formData")}addValidatedData(e,t){o(this,he)[e]=t}valid(e){return o(this,he)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return o(this,T)[0].map(([[,e]])=>e)}get routePath(){return o(this,T)[0].map(([[,e]])=>e)[this.routeIndex].path}},he=new WeakMap,T=new WeakMap,M=new WeakSet,Gt=function(e){let t=o(this,T)[0][this.routeIndex][1][e],r=y(this,M,pt).call(this,t);return r?/\%/.test(r)?Ft(r):r:void 0},Kt=function(){let e={},t=Object.keys(o(this,T)[0][this.routeIndex][1]);for(let r of t){let s=y(this,M,pt).call(this,o(this,T)[0][this.routeIndex][1][r]);s&&typeof s=="string"&&(e[r]=/\%/.test(s)?Ft(s):s)}return e},pt=function(e){return o(this,T)[1]?o(this,T)[1][e]:e},K=new WeakMap,Ut);var Wt={Stringify:1,BeforeStream:2,Stream:3},qr=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r};var yt=(e,t,r,s,n)=>x(void 0,null,function*(){typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=yield e));let a=e.callbacks;if(!(a!=null&&a.length))return Promise.resolve(e);n?n[0]+=e:n=[e];let c=Promise.all(a.map(h=>h({phase:t,buffer:n,context:s}))).then(h=>Promise.all(h.filter(Boolean).map(i=>yt(i,t,!1,s,n))).then(()=>n[0]));return r?qr(yield c,a):c});var Nr="text/plain; charset=UTF-8",mt=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},we,Ee,k,X,q,R,w,$,N,xe,le,fe,Oe,Se,j,A,Vt,Ne=(Vt=class{constructor(e,t){p(this,j);p(this,we);p(this,Ee);d(this,"env",{});p(this,k);d(this,"finalized",!1);d(this,"error");p(this,X,200);p(this,q);p(this,R);p(this,w);p(this,$);p(this,N,!0);p(this,xe);p(this,le);p(this,fe);p(this,Oe);p(this,Se);d(this,"render",(...e)=>{var t;return(t=o(this,le))!=null||u(this,le,r=>this.html(r)),o(this,le).call(this,...e)});d(this,"setLayout",e=>u(this,xe,e));d(this,"getLayout",()=>o(this,xe));d(this,"setRenderer",e=>{u(this,le,e)});d(this,"header",(e,t,r)=>{var s;if(t===void 0){o(this,R)?o(this,R).delete(e):o(this,w)&&delete o(this,w)[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r!=null&&r.append?(o(this,R)||(u(this,N,!1),u(this,R,new Headers(o(this,w))),u(this,w,{})),o(this,R).append(e,t)):o(this,R)?o(this,R).set(e,t):((s=o(this,w))!=null||u(this,w,{}),o(this,w)[e.toLowerCase()]=t),this.finalized&&(r!=null&&r.append?this.res.headers.append(e,t):this.res.headers.set(e,t))});d(this,"status",e=>{u(this,N,!1),u(this,X,e)});d(this,"set",(e,t)=>{var r;(r=o(this,k))!=null||u(this,k,new Map),o(this,k).set(e,t)});d(this,"get",e=>o(this,k)?o(this,k).get(e):void 0);d(this,"newResponse",(...e)=>y(this,j,A).call(this,...e));d(this,"body",(e,t,r)=>typeof t=="number"?y(this,j,A).call(this,e,t,r):y(this,j,A).call(this,e,t));d(this,"text",(e,t,r)=>{if(!o(this,w)){if(o(this,N)&&!r&&!t)return new Response(e);u(this,w,{})}return o(this,w)["content-type"]=Nr,typeof t=="number"?y(this,j,A).call(this,e,t,r):y(this,j,A).call(this,e,t)});d(this,"json",(e,t,r)=>{var n;let s=JSON.stringify(e);return(n=o(this,w))!=null||u(this,w,{}),o(this,w)["content-type"]="application/json",typeof t=="number"?y(this,j,A).call(this,s,t,r):y(this,j,A).call(this,s,t)});d(this,"html",(e,t,r)=>{var s;return(s=o(this,w))!=null||u(this,w,{}),o(this,w)["content-type"]="text/html; charset=UTF-8",typeof e=="object"?yt(e,Wt.Stringify,!1,{}).then(n=>typeof t=="number"?y(this,j,A).call(this,n,t,r):y(this,j,A).call(this,n,t)):typeof t=="number"?y(this,j,A).call(this,e,t,r):y(this,j,A).call(this,e,t)});d(this,"redirect",(e,t)=>{var r;return(r=o(this,R))!=null||u(this,R,new Headers),o(this,R).set("Location",String(e)),this.newResponse(null,t!=null?t:302)});d(this,"notFound",()=>{var e;return(e=o(this,fe))!=null||u(this,fe,()=>new Response),o(this,fe).call(this,this)});u(this,we,e),t&&(u(this,q,t.executionCtx),this.env=t.env,u(this,fe,t.notFoundHandler),u(this,Se,t.path),u(this,Oe,t.matchResult))}get req(){var e;return(e=o(this,Ee))!=null||u(this,Ee,new Me(o(this,we),o(this,Se),o(this,Oe))),o(this,Ee)}get event(){if(o(this,q)&&"respondWith"in o(this,q))return o(this,q);throw Error("This context has no FetchEvent")}get executionCtx(){if(o(this,q))return o(this,q);throw Error("This context has no ExecutionContext")}get res(){return u(this,N,!1),o(this,$)||u(this,$,new Response("404 Not Found",{status:404}))}set res(e){if(u(this,N,!1),o(this,$)&&e)try{for(let[t,r]of o(this,$).headers.entries())if(t!=="content-type")if(t==="set-cookie"){let s=o(this,$).headers.getSetCookie();e.headers.delete("set-cookie");for(let n of s)e.headers.append("set-cookie",n)}else e.headers.set(t,r)}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}else throw t}u(this,$,e),this.finalized=!0}get var(){return o(this,k)?Object.fromEntries(o(this,k)):{}}},we=new WeakMap,Ee=new WeakMap,k=new WeakMap,X=new WeakMap,q=new WeakMap,R=new WeakMap,w=new WeakMap,$=new WeakMap,N=new WeakMap,xe=new WeakMap,le=new WeakMap,fe=new WeakMap,Oe=new WeakMap,Se=new WeakMap,j=new WeakSet,A=function(e,t,r){var n,a,c;if(o(this,N)&&!r&&!t&&o(this,X)===200)return new Response(e,{headers:o(this,w)});if(t&&typeof t!="number"){let h=new Headers(t.headers);o(this,R)&&o(this,R).forEach((l,f)=>{f==="set-cookie"?h.append(f,l):h.set(f,l)});let i=mt(h,o(this,w));return new Response(e,{headers:i,status:(n=t.status)!=null?n:o(this,X)})}let s=typeof t=="number"?t:o(this,X);(a=o(this,w))!=null||u(this,w,{}),(c=o(this,R))!=null||u(this,R,new Headers),mt(o(this,R),o(this,w)),o(this,$)&&(o(this,$).headers.forEach((h,i)=>{var l,f;i==="set-cookie"?(l=o(this,R))==null||l.append(i,h):(f=o(this,R))==null||f.set(i,h)}),mt(o(this,R),o(this,w))),r!=null||(r={});for(let[h,i]of Object.entries(r))if(typeof i=="string")o(this,R).set(h,i);else{o(this,R).delete(h);for(let l of i)o(this,R).append(h,l)}return new Response(e,{status:s,headers:o(this,R)})},Vt);var bt=(e,t,r)=>(s,n)=>{let a=-1,c=s instanceof Ne;return h(0);function h(i){return x(this,null,function*(){if(i<=a)throw new Error("next() called multiple times");a=i;let l,f=!1,m;if(e[i]?(m=e[i][0][0],c&&(s.req.routeIndex=i)):m=i===e.length&&n||void 0,!m)c&&s.finalized===!1&&r&&(l=yield r(s));else try{l=yield m(s,()=>h(i+1))}catch(v){if(v instanceof Error&&c&&t)s.error=v,l=yield t(v,s),f=!0;else throw v}return l&&(s.finalized===!1||f)&&(s.res=l),s})}};var g="ALL",zt="all",Qt=["get","post","put","delete","options","patch"],Be="Can not add a route since the matcher is already built.",Fe=class extends Error{};var Br=Symbol("composedHandler"),Fr=e=>e.text("404 Not Found",404),Xt=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),L,E,Jt,B,Y,Ue,Ge,Yt,vt=(Yt=class{constructor(e={}){p(this,E);d(this,"get");d(this,"post");d(this,"put");d(this,"delete");d(this,"options");d(this,"patch");d(this,"all");d(this,"on");d(this,"use");d(this,"router");d(this,"getPath");d(this,"_basePath","/");p(this,L,"/");d(this,"routes",[]);p(this,B,Fr);d(this,"errorHandler",Xt);d(this,"onError",e=>(this.errorHandler=e,this));d(this,"notFound",e=>(u(this,B,e),this));d(this,"fetch",(e,...t)=>y(this,E,Ge).call(this,e,t[1],t[0],e.method));d(this,"request",(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${ce("/",e)}`,t),r,s)));d(this,"fire",()=>{addEventListener("fetch",e=>{e.respondWith(y(this,E,Ge).call(this,e.request,e,void 0,e.request.method))})});var s,n;[...Qt,zt].forEach(a=>{this[a]=(c,...h)=>(typeof c=="string"?u(this,L,c):y(this,E,Y).call(this,a,o(this,L),c),h.forEach(i=>{y(this,E,Y).call(this,a,o(this,L),i)}),this)}),this.on=(a,c,...h)=>{for(let i of[c].flat()){u(this,L,i);for(let l of[a].flat())h.map(f=>{y(this,E,Y).call(this,l.toUpperCase(),o(this,L),f)})}return this},this.use=(a,...c)=>(typeof a=="string"?u(this,L,a):(u(this,L,"*"),c.unshift(a)),c.forEach(h=>{y(this,E,Y).call(this,g,o(this,L),h)}),this);let r=(s=e.strict)!=null?s:!0;delete e.strict,Object.assign(this,e),this.getPath=r?(n=e.getPath)!=null?n:ut:kt}route(e,t){let r=this.basePath(e);return t.routes.map(s=>{var a;let n;t.errorHandler===Xt?n=s.handler:(n=(c,h)=>x(this,null,function*(){return(yield bt([],t.errorHandler)(c,()=>s.handler(c,h))).res}),n[Br]=s.handler),y(a=r,E,Y).call(a,s.method,s.path,n)}),this}basePath(e){let t=y(this,E,Jt).call(this);return t._basePath=ce(this._basePath,e),t}mount(e,t,r){let s,n;r&&(typeof r=="function"?n=r:(n=r.optionHandler,s=r.replaceRequest));let a=n?h=>{let i=n(h);return Array.isArray(i)?i:[i]}:h=>{let i;try{i=h.executionCtx}catch(l){}return[h.env,i]};s||(s=(()=>{let h=ce(this._basePath,e),i=h==="/"?0:h.length;return l=>{let f=new URL(l.url);return f.pathname=f.pathname.slice(i)||"/",new Request(f,l)}})());let c=(h,i)=>x(this,null,function*(){let l=yield t(s(h.req.raw),...a(h));if(l)return l;yield i()});return y(this,E,Y).call(this,g,ce(e,"*"),c),this}},L=new WeakMap,E=new WeakSet,Jt=function(){let e=new vt({router:this.router,getPath:this.getPath});return e.routes=this.routes,e},B=new WeakMap,Y=function(e,t,r){e=e.toUpperCase(),t=ce(this._basePath,t);let s={path:t,method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)},Ue=function(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e},Ge=function(e,t,r,s){if(s==="HEAD")return x(this,null,function*(){return new Response(null,yield y(this,E,Ge).call(this,e,t,r,"GET"))});let n=this.getPath(e,{env:r}),a=this.router.match(s,n),c=new Ne(e,{path:n,matchResult:a,env:r,executionCtx:t,notFoundHandler:o(this,B)});if(a[0].length===1){let i;try{i=a[0][0][0][0](c,()=>x(this,null,function*(){c.res=yield o(this,B).call(this,c)}))}catch(l){return y(this,E,Ue).call(this,l,c)}return i instanceof Promise?i.then(l=>l||(c.finalized?c.res:o(this,B).call(this,c))).catch(l=>y(this,E,Ue).call(this,l,c)):i!=null?i:o(this,B).call(this,c)}let h=bt(a[0],this.errorHandler,o(this,B));return x(this,null,function*(){try{let i=yield h(c);if(!i.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return i.res}catch(i){return y(this,E,Ue).call(this,i,c)}})},Yt);var Ke="[^/]+",Pe=".*",je="(?:|/.*)",ue=Symbol(),Ur=new Set(".\\+*[^]$()");function Gr(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Pe||e===je?1:t===Pe||t===je?-1:e===Ke?1:t===Ke?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var J,Z,_,Zt,We=(Zt=class{constructor(){p(this,J);p(this,Z);p(this,_,Object.create(null))}insert(e,t,r,s,n){if(e.length===0){if(o(this,J)!==void 0)throw ue;if(n)return;u(this,J,t);return}let[a,...c]=e,h=a==="*"?c.length===0?["","",Pe]:["","",Ke]:a==="/*"?["","",je]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/),i;if(h){let l=h[1],f=h[2]||Ke;if(l&&h[2]&&(f=f.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(f)))throw ue;if(i=o(this,_)[f],!i){if(Object.keys(o(this,_)).some(m=>m!==Pe&&m!==je))throw ue;if(n)return;i=o(this,_)[f]=new We,l!==""&&u(i,Z,s.varIndex++)}!n&&l!==""&&r.push([l,o(i,Z)])}else if(i=o(this,_)[a],!i){if(Object.keys(o(this,_)).some(l=>l.length>1&&l!==Pe&&l!==je))throw ue;if(n)return;i=o(this,_)[a]=new We}i.insert(c,t,r,s,n)}buildRegExpStr(){let t=Object.keys(o(this,_)).sort(Gr).map(r=>{let s=o(this,_)[r];return(typeof o(s,Z)=="number"?`(${r})@${o(s,Z)}`:Ur.has(r)?`\\${r}`:r)+s.buildRegExpStr()});return typeof o(this,J)=="number"&&t.unshift(`#${o(this,J)}`),t.length===0?"":t.length===1?t[0]:"(?:"+t.join("|")+")"}},J=new WeakMap,Z=new WeakMap,_=new WeakMap,Zt);var Ve,Ae,er,tr=(er=class{constructor(){p(this,Ve,{varIndex:0});p(this,Ae,new We)}insert(e,t,r){let s=[],n=[];for(let c=0;;){let h=!1;if(e=e.replace(/\{[^}]+\}/g,i=>{let l=`@\\${c}`;return n[c]=[l,i],c++,h=!0,l}),!h)break}let a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let c=n.length-1;c>=0;c--){let[h]=n[c];for(let i=a.length-1;i>=0;i--)if(a[i].indexOf(h)!==-1){a[i]=a[i].replace(h,n[c][1]);break}}return o(this,Ae).insert(a,t,s,o(this,Ve),r),s}buildRegExp(){let e=o(this,Ae).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0,r=[],s=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,a,c)=>a!==void 0?(r[++t]=Number(a),"$()"):(c!==void 0&&(s[Number(c)]=++t),"")),[new RegExp(`^${e}`),r,s]}},Ve=new WeakMap,Ae=new WeakMap,er);var sr=[],Kr=[/^$/,[],Object.create(null)],ze=Object.create(null);function nr(e){var t;return(t=ze[e])!=null?t:ze[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(r,s)=>s?`\\${s}`:"(?:|/.*)")}$`)}function Wr(){ze=Object.create(null)}function Vr(e){var l;let t=new tr,r=[];if(e.length===0)return Kr;let s=e.map(f=>[!/\*|\/:/.test(f[0]),...f]).sort(([f,m],[v,b])=>f?1:v?-1:m.length-b.length),n=Object.create(null);for(let f=0,m=-1,v=s.length;f<v;f++){let[b,O,D]=s[f];b?n[O]=[D.map(([H])=>[H,Object.create(null)]),sr]:m++;let I;try{I=t.insert(O,m,b)}catch(H){throw H===ue?new Fe(O):H}b||(r[m]=D.map(([H,C])=>{let Ce=Object.create(null);for(C-=1;C>=0;C--){let[Te,se]=I[C];Ce[Te]=se}return[H,Ce]}))}let[a,c,h]=t.buildRegExp();for(let f=0,m=r.length;f<m;f++)for(let v=0,b=r[f].length;v<b;v++){let O=(l=r[f][v])==null?void 0:l[1];if(!O)continue;let D=Object.keys(O);for(let I=0,H=D.length;I<H;I++)O[D[I]]=h[O[D[I]]]}let i=[];for(let f in c)i[f]=r[c[f]];return[a,i,n]}function de(e,t){if(e){for(let r of Object.keys(e).sort((s,n)=>n.length-s.length))if(nr(r).test(t))return[...e[r]]}}var W,V,pe,or,ir,rr,Rt=(rr=class{constructor(){p(this,pe);d(this,"name","RegExpRouter");p(this,W);p(this,V);u(this,W,{[g]:Object.create(null)}),u(this,V,{[g]:Object.create(null)})}add(e,t,r){var h;let s=o(this,W),n=o(this,V);if(!s||!n)throw new Error(Be);s[e]||[s,n].forEach(i=>{i[e]=Object.create(null),Object.keys(i[g]).forEach(l=>{i[e][l]=[...i[g][l]]})}),t==="/*"&&(t="*");let a=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){let i=nr(t);e===g?Object.keys(s).forEach(l=>{var f;(f=s[l])[t]||(f[t]=de(s[l],t)||de(s[g],t)||[])}):(h=s[e])[t]||(h[t]=de(s[e],t)||de(s[g],t)||[]),Object.keys(s).forEach(l=>{(e===g||e===l)&&Object.keys(s[l]).forEach(f=>{i.test(f)&&s[l][f].push([r,a])})}),Object.keys(n).forEach(l=>{(e===g||e===l)&&Object.keys(n[l]).forEach(f=>i.test(f)&&n[l][f].push([r,a]))});return}let c=qe(t)||[t];for(let i=0,l=c.length;i<l;i++){let f=c[i];Object.keys(n).forEach(m=>{var v;(e===g||e===m)&&((v=n[m])[f]||(v[f]=[...de(s[m],f)||de(s[g],f)||[]]),n[m][f].push([r,a-l+i+1]))})}}match(e,t){Wr();let r=y(this,pe,or).call(this);return this.match=(s,n)=>{let a=r[s]||r[g],c=a[2][n];if(c)return c;let h=n.match(a[0]);if(!h)return[[],sr];let i=h.indexOf("",1);return[a[1][i],h]},this.match(e,t)}},W=new WeakMap,V=new WeakMap,pe=new WeakSet,or=function(){let e=Object.create(null);return Object.keys(o(this,V)).concat(Object.keys(o(this,W))).forEach(t=>{e[t]||(e[t]=y(this,pe,ir).call(this,t))}),u(this,W,u(this,V,void 0)),e},ir=function(e){let t=[],r=e===g;return[o(this,W),o(this,V)].forEach(s=>{let n=s[e]?Object.keys(s[e]).map(a=>[a,s[e][a]]):[];n.length!==0?(r||(r=!0),t.push(...n)):e!==g&&t.push(...Object.keys(s[g]).map(a=>[a,s[g][a]]))}),r?Vr(t):null},rr);var z,F,ar,gt=(ar=class{constructor(e){d(this,"name","SmartRouter");p(this,z,[]);p(this,F,[]);u(this,z,e.routers)}add(e,t,r){if(!o(this,F))throw new Error(Be);o(this,F).push([e,t,r])}match(e,t){if(!o(this,F))throw new Error("Fatal error");let r=o(this,z),s=o(this,F),n=r.length,a=0,c;for(;a<n;a++){let h=r[a];try{for(let i=0,l=s.length;i<l;i++)h.add(...s[i]);c=h.match(e,t)}catch(i){if(i instanceof Fe)continue;throw i}this.match=h.match.bind(h),u(this,z,[h]),u(this,F,void 0);break}if(a===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,c}get activeRouter(){if(o(this,F)||o(this,z).length!==1)throw new Error("No active router has been determined yet.");return o(this,z)[0]}},z=new WeakMap,F=new WeakMap,ar);var He=Object.create(null),Q,S,te,ye,P,U,ee,cr,wt=(cr=class{constructor(e,t,r){p(this,U);p(this,Q);p(this,S);p(this,te);p(this,ye,0);p(this,P,He);if(u(this,S,r||Object.create(null)),u(this,Q,[]),e&&t){let s=Object.create(null);s[e]={handler:t,possibleKeys:[],score:0},u(this,Q,[s])}u(this,te,[])}insert(e,t,r){u(this,ye,++At(this,ye)._);let s=this,n=Mt(t),a=[];for(let i=0,l=n.length;i<l;i++){let f=n[i];if(Object.keys(o(s,S)).includes(f)){s=o(s,S)[f];let v=lt(f);v&&a.push(v[1]);continue}o(s,S)[f]=new wt;let m=lt(f);m&&(o(s,te).push(m),a.push(m[1])),s=o(s,S)[f]}let c=Object.create(null),h={handler:r,possibleKeys:a.filter((i,l,f)=>f.indexOf(i)===l),score:o(this,ye)};return c[e]=h,o(s,Q).push(c),s}search(e,t){let r=[];u(this,P,He);let n=[this],a=ht(t);for(let c=0,h=a.length;c<h;c++){let i=a[c],l=c===h-1,f=[];for(let m=0,v=n.length;m<v;m++){let b=n[m],O=o(b,S)[i];O&&(u(O,P,o(b,P)),l?(o(O,S)["*"]&&r.push(...y(this,U,ee).call(this,o(O,S)["*"],e,o(b,P))),r.push(...y(this,U,ee).call(this,O,e,o(b,P)))):f.push(O));for(let D=0,I=o(b,te).length;D<I;D++){let H=o(b,te)[D],C=o(b,P)===He?{}:Le({},o(b,P));if(H==="*"){let Qe=o(b,S)["*"];Qe&&(r.push(...y(this,U,ee).call(this,Qe,e,o(b,P))),f.push(Qe));continue}if(i==="")continue;let[Ce,Te,se]=H,ne=o(b,S)[Ce],Ot=a.slice(c).join("/");if(se instanceof RegExp&&se.test(Ot)){C[Te]=Ot,r.push(...y(this,U,ee).call(this,ne,e,o(b,P),C));continue}(se===!0||se.test(i))&&(C[Te]=i,l?(r.push(...y(this,U,ee).call(this,ne,e,C,o(b,P))),o(ne,S)["*"]&&r.push(...y(this,U,ee).call(this,o(ne,S)["*"],e,C,o(b,P)))):(u(ne,P,C),f.push(ne)))}}n=f}return r.length>1&&r.sort((c,h)=>c.score-h.score),[r.map(({handler:c,params:h})=>[c,h])]}},Q=new WeakMap,S=new WeakMap,te=new WeakMap,ye=new WeakMap,P=new WeakMap,U=new WeakSet,ee=function(e,t,r,s){var a;let n=[];for(let c=0,h=o(e,Q).length;c<h;c++){let i=o(e,Q)[c],l=i[t]||i[g],f={};if(l!==void 0&&(l.params=Object.create(null),n.push(l),r!==He||s&&s!==He))for(let m=0,v=l.possibleKeys.length;m<v;m++){let b=l.possibleKeys[m],O=f[l.score];l.params[b]=s!=null&&s[b]&&!O?s[b]:(a=r[b])!=null?a:s==null?void 0:s[b],f[l.score]=!0}}return n},cr);var re,hr,Et=(hr=class{constructor(){d(this,"name","TrieRouter");p(this,re);u(this,re,new wt)}add(e,t,r){let s=qe(t);if(s){for(let n=0,a=s.length;n<a;n++)o(this,re).insert(e,s[n],r);return}o(this,re).insert(e,t,r)}match(e,t){return o(this,re).search(e,t)}},re=new WeakMap,hr);var xt=class extends vt{constructor(e={}){var t;super(e),this.router=(t=e.router)!=null?t:new gt({routers:[new Rt,new Et]})}};var lr=new xt;lr.get("/",e=>e.text("Hello, Hono!"));var fr=3e3;console.log(`Server is running on http://localhost:${fr}`);$t({fetch:lr.fetch,port:fr});
